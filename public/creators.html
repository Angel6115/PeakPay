<!doctype html>
<html lang="es">
<head>
  <link rel="preload" as="style" href="/styles.min.css" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="/styles.min.css"></noscript>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PeekPay — Creadores</title>

  <link rel="icon" href="/favicon.ico">
  <link rel="canonical" href="https://peak-pay.vercel.app/creators">
  <meta name="description" content="Descubre creadores y sus peeks. Desbloquea mosaicos con Peak Credits.">
  <meta property="og:site_name" content="PeekPay">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Creadores — PeekPay">
  <meta property="og:description" content="Explora perfiles y desbloquea mosaicos con créditos.">
  <meta property="og:url" content="https://peak-pay.vercel.app/creators">
  <meta property="og:image" content="https://peak-pay.vercel.app/peak1.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Creadores — PeekPay">
  <meta name="twitter:description" content="Explora perfiles y desbloquea mosaicos con créditos.">
  <meta name="twitter:image" content="https://peak-pay.vercel.app/peak1.png">
  <link rel="preconnect" href="https://plausible.io">
  <script defer data-domain="peak-pay.vercel.app" src="https://plausible.io/js/script.js"></script>

  <style>
    :root{
      --bg:#ffffff; --text:#0b1020; --muted:#475569; --card:#f8fafc; --ring:#e2e8f0;
      --ok:#059669; --err:#b91c1c; --indigo:#4f46e5; --blue:#2563eb;
    }
    *{ box-sizing:border-box }
    body{ margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,Arial,sans-serif }
    .wrap{ max-width:1120px; margin:0 auto; padding:28px 16px 64px }

    .head{ display:flex; align-items:center; gap:10px; justify-content:space-between; }
    header{ display:flex; align-items:center; gap:10px; }
    header img{ width:44px; height:44px; border-radius:12px; object-fit:cover; box-shadow:0 6px 14px rgba(79,70,229,.06) }
    .brand h1{ margin:0; font-size:18px }
    .brand p{ margin:0; color:var(--muted); font-size:12px }

    .btn{
      border:0; background: linear-gradient(90deg, var(--indigo) 0%, var(--blue) 100%);
      color:#fff; border-radius:10px; padding:10px 14px; cursor:pointer; text-decoration:none;
      box-shadow: 0 6px 16px rgba(79,70,229,.25); white-space:nowrap; display:inline-block;
    }
    .btn:hover{ filter: brightness(1.05) }
    .btn.secondary{ background:#fff; color:var(--indigo); border:1px solid var(--ring); box-shadow:none }

    .panel{ border:1px solid var(--ring); background:var(--card); border-radius:16px; padding:16px; margin-top:12px; box-shadow:0 6px 14px rgba(79,70,229,.06) }

    /* Grid de creadores */
    .grid{ display:grid; gap:12px; margin-top:12px }
    @media (min-width:720px){ .grid{ grid-template-columns: repeat(3, minmax(0,1fr)); } }
    @media (min-width:1024px){ .grid{ grid-template-columns: repeat(4, minmax(0,1fr)); } }

    .card{ border:1px solid var(--ring); background:#fff; border-radius:14px; overflow:hidden; display:flex; flex-direction:column }
    .card img{ width:100%; aspect-ratio:4/3; object-fit:cover; display:block }
    .card .meta{ padding:10px 12px; display:flex; align-items:center; justify-content:space-between; gap:8px }
    .card .meta h3{ margin:0; font-size:14px }
    .muted{ color:var(--muted); font-size:12px }

    /* Gate overlay (se verá un instante) */
    .gate{
      border:1px dashed var(--ring); background:#fff; border-radius:14px; padding:16px; text-align:center
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Header -->
    <div class="head">
      <div style="display:flex;align-items:center;gap:10px">
        <header><img src="/peak1.png" alt="PeekPay"></header>
        <div class="brand">
          <h1>PeekPay</h1>
          <p>Unblur your curiosity</p>
        </div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <a class="btn secondary" href="/login.html">Entrar</a>
        <a class="btn" href="/signup.html">Crear cuenta</a>
      </div>
    </div>

    <!-- Gate suave: mensaje breve mientras redirige si no hay sesión -->
    <section id="gate" class="panel gate" style="display:none">
      <h2 style="margin:0 0 6px; font-size:18px">Crea tu cuenta para ver los creadores</h2>
      <p class="muted" style="margin:0 0 10px">Te tomará 20 segundos. Verificación por email.</p>
      <div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
        <a class="btn" id="goSignup" href="/signup.html">Crear cuenta</a>
        <a class="btn secondary" href="/login.html">Entrar</a>
      </div>
      <p class="muted" style="margin-top:10px">Si estás probando, puedes usar <code>?preview=1</code> en la URL.</p>
    </section>

    <!-- Contenido real -->
    <section id="content" class="panel" aria-labelledby="crea-title" style="display:none">
      <h2 id="crea-title" style="margin:0 0 8px">Creadores destacados</h2>
      <div id="grid" class="grid" aria-live="polite"></div>
      <p id="empty" class="muted" style="display:none">No hay creadores para mostrar.</p>
    </section>
  </div>

  <noscript>
    <div class="wrap">
      <section class="panel gate">
        <h2>Necesitas activar JavaScript</h2>
        <p class="muted">Activa JavaScript para continuar o <a href="/signup.html">crea tu cuenta aquí</a>.</p>
      </section>
    </div>
  </noscript>

  <script>
    // -------- GATE SUAVE --------
    (function gate(){
      const params = new URLSearchParams(location.search);
      const preview = params.get('preview') === '1';
      const isAuthed = !!localStorage.getItem('pp_auth'); // TODO: reemplazar por flag real cuando tengamos login

      if (!isAuthed && !preview) {
        // Mostrar gate breve y redirigir a signup con next
        const gateEl = document.getElementById('gate');
        gateEl.style.display = 'block';
        const next = location.pathname + location.search;
        document.getElementById('goSignup').href = '/signup.html?next=' + encodeURIComponent(next);
        try { if (window.plausible) plausible('gate_creators'); } catch(e){}

        // Redirige en ~900ms para que se vea el mensaje
        setTimeout(()=>{ location.href = '/signup.html?next=' + encodeURIComponent(next); }, 900);
        return;
      }

      // Autorizado o preview: mostrar contenido real
      document.getElementById('content').style.display = 'block';
    })();

    // -------- CARGA DE CREADORES (usa peeks.json actual) --------
    (async function loadCreators(){
      const grid = document.getElementById('grid');
      const empty = document.getElementById('empty');
      if (!grid) return;

      try {
        const res = await fetch('/peeks.json?ts=' + Date.now());
        if (!res.ok) throw new Error('fetch peeks failed');
        const data = await res.json();

        // Esperamos estructura con sets / creators; adaptamos a lo que ya tienes (fallback)
        const creators = Array.isArray(data?.creators) ? data.creators : [];

        if (!creators.length) {
          empty.style.display = 'block';
          return;
        }

        const frag = document.createDocumentFragment();
        creators.forEach(c=>{
          const a = document.createElement('a');
          a.href = '/peek.html?creator=' + encodeURIComponent(c.id || c.handle || '');
          a.className = 'card';
          a.innerHTML = `
            <img loading="lazy" decoding="async" src="${c.cover || '/photos/artistico/cover.jpg'}" alt="${(c.name||c.handle||'Creator')}" />
            <div class="meta">
              <h3>${c.name || c.handle || 'Creator'}</h3>
              <span class="muted">${(c.sets||0)} sets</span>
            </div>
          `;
          frag.appendChild(a);
        });
        grid.appendChild(frag);
      } catch (e) {
        empty.textContent = 'No se pudieron cargar los creadores.';
        empty.style.display = 'block';
      }
    })();
  </script>
<script src="/_header.js" defer></script>
</body>
</html>
